{% extends base_template %}

{% load i18n static %}

{% block title %}Active Directory Copilot{% endblock %}

{% block dynamic_head_content %}
<link rel="stylesheet" type="text/css" media="all" href="{% static 'myview/css/active-directory-copilot.css' %}" />
{% endblock %}

{% block headline %}Active Directory Copilot{% endblock %}

{% block main-content %}
<div class="container my-4">
    <h2>Active Directory Copilot</h2>

    <form method="post" id="copilot-form">
        {% csrf_token %}
        <div class="mb-3 position-relative">
            <label for="copilot-submit-textarea-field" class="form-label">Copilot
                <i class="bi bi-question-circle-fill" data-bs-toggle="tooltip" data-bs-placement="right" title="Enter your query for Active Directory" data-bs-html="true"></i>
            </label>
            <textarea id="copilot-submit-textarea-field" name="text" cols="60" rows="1" required="" class="form-control">Give me a query with users from 'win.dtu.dk/AIT/CIS/SOC', and include the 'pwdLastSet' attribute for each user.</textarea>
        </div>

        <!-- Input fields for parameters -->
        <div class="mb-3">
            <label for="base_dn" class="form-label">Base DN</label>
            <div class="d-flex">
                <input type="text" id="base_dn" class="form-control" placeholder="OU=SOC,OU=CIS,OU=AIT,DC=win,DC=dtu,DC=dk">
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="base_dn_lock" checked>
                    <label class="form-check-label" for="base_dn_lock">Lock</label>
                </div>
            </div>
            <div class="d-flex align-items-center mt-2">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="canonical_name_switch">
                    <label class="form-check-label" for="canonical_name_switch">Canonical Name Notation</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="search_filter" class="form-label">Search Filter</label>
            <div class="d-flex">
                <input type="text" id="search_filter" class="form-control" placeholder="(objectClass=user)">
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="search_filter_lock" checked>
                    <label class="form-check-label" for="search_filter_lock">Lock</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="search_attributes" class="form-label">Search Attributes</label>
            <div class="d-flex">
                <input type="text" id="search_attributes" class="form-control" placeholder="pwdLastSet">
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="search_attributes_lock" checked>
                    <label class="form-check-label" for="search_attributes_lock">Lock</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="limit" class="form-label">Limit</label>
            <div class="d-flex">
                <input type="number" id="limit" class="form-control" placeholder="100">
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="limit_lock" checked>
                    <label class="form-check-label" for="limit_lock">Lock</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="excluded_attributes" class="form-label">Excluded Attributes</label>
            <div class="d-flex">
                <input type="text" id="excluded_attributes" class="form-control" placeholder="thumbnailPhoto">
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="excluded_attributes_lock" checked>
                    <label class="form-check-label" for="excluded_attributes_lock">Lock</label>
                </div>
            </div>
        </div>

        <div class="d-flex align-items-center">
            <button type="submit" id="copilot-submit-btn" class="btn btn-primary">Go</button>
            <div id="loadingSpinnerCopilot" class="spinner-border text-primary ms-3" role="status" style="display: none;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </form>

    <div class="mt-4">
        <label class="form-label">Toggle between JSON and Excel View</label>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="toggle-view">
            <label class="form-check-label" for="toggle-view">Show Excel</label>
        </div>
    </div>

    <!-- Container to display the result -->
    <div id="copilot-result-container" style="display: none;">
        <h3>Query Result (Number of returned objects: <span id="returned_objects_count"></span>)</h3>

        <!-- Scrollable JSON result view -->
        <div id="json-view" class="scrollable-div-80vh">
            <pre id="copilot-result"></pre>
        </div>

        <!-- Scrollable Excel view (hidden by default) -->
        <div id="excel-view" class="scrollable-div-80vh" style="display: none;">
            <table id="excel-table" class="table table-bordered table-hover"></table>
        </div>

        <button id="download-json-btn" class="btn btn-success">Download JSON</button>
        <a id="download-xlsx-btn" class="btn btn-success" href="#" style="display: none;">Download XLSX</a>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'myview/js/active-directory-copilot.js' %}" defer></script>
{% endblock %}
